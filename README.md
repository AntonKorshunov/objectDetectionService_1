# objectDetectionService

## Требования:

Python v.3.9 <

## Запуск:

1. Склонировать ветку
2. Прописать в консоли для настройки окружения pip install -r requirements.txt
3. py run.py (при первом запуске сначала автоматически скачаются веса для YOLOv5)

## Задача: определить, живой или нет объект перед камерой и распознать его, если объект не живой.

### Service: Базовый класс для создания сетевых сервисов.

Предоставляет абстрактный интерфейс для управления сетевыми соединениями, обеспечивая возможность создания и управления собственными сетевыми приложениями.

### ServiceOD: Обнаружение объектов и определение живое/неживое на видеопотоке с YOLOv5

#### `_do_job(self)`

- Устанавливает соединение с видеопотоком.
- Инициализирует переменные и модель YOLOv5.
- Обрабатывает каждый кадр из видеопотока с использованием модели YOLOv5.
- Выводит результат обработки.

#### `__init_vars(self)`

Метод инициализирует необходимые переменные, такие как веса модели YOLOv5 и флаг активности модели.

#### `_start_yolo(self)`

Метод выполняет начальную настройку модели YOLOv5, включая установку параметров модели. А также определяет массив классов, относящихся к живым существам и осуществляет проверку элементов живой/неживой объект.

#### `__resp_hand(self, response)`

Метод предназначен для обработки ответов.

#### `__specific_work(self)`

Метод выполняет специфичную для данного сервиса работу над фреймом в потоке

#### `_request_handler(self, request)`

Метод обрабатывает входящие запросы, отправленные клиентами. Доступны запросы, такие как:

- `'checkAlive'`: Возвращает True, если есть кто-то живой в кадре, иначе False.
- `'getFrame'`: Возвращает закондированное изображение с распознанными объектами (с боксами).
- `'getObjects'`: Возвращает список объектов в кадре. Если нет ни одного, то возвращает ‘empty’.
- `'getDownNN'`: Так как в сервисе крутится YOLO, то ее веса постоянно подняты. Если нужно освободить память и ресурсы, то можно просто ее отключить. Возвращает `ok`, либо `failed`.
- `'getUpNN_'`: Обратная операция предыдущего пункта. Если нейросеть уже поднята, то перезагружает веса, если указаны новые. Возвращает `ok`, либо `failed`.
- `'applyThreshold_'`: Применение порога доверительных оценок модели YOLOv5. Диапазон от (0., 1.] По умолчанию 0.25. Возвращает “ok”, если был установлен порог, иначе “failed” (например, значение не попадает в диапазон).

#### Camera

Класс `Camera` представляет собой простую реализацию захвата видеопотока с использованием библиотеки OpenCV. 

#### `__init__(self, rtsp_link)`

Конструктор класса `Camera` принимает RTSP-ссылку в качестве аргумента и инициализирует объект захвата видеопотока с использованием переданной ссылки. Затем создается и запускается отдельный поток `rtsp_cam_buffer`, который непрерывно читает кадры из видеопотока.

#### `rtsp_cam_buffer(self, capture)`

Этот метод работает в отдельном потоке и выполняет непрерывное чтение кадров из захвата видеопотока. Полученные кадры сохраняются в переменных `self.last_ready` (флаг готовности) и `self.last_frame` (последний кадр). Метод выполняется бесконечно в фоновом режиме.

#### `getFrame(self)`

Метод `getFrame` предназначен для получения последнего захваченного кадра. Если последний кадр доступен (`self.last_ready` и `self.last_frame` не равны `None`), метод возвращает копию последнего кадра в формате NumPy массива. В противном случае, метод возвращает `None`.

